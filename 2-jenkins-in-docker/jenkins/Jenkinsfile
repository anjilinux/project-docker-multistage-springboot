pipeline {
  agent none
  // environment {
  //   PACKER_CACHE_DIR = "${env.WORKSPACE_TMP}/.packer.d/packer_cache"
  //   PACKER_CONFIG_DIR = "${env.WORKSPACE_TMP}/.packer.d"
  //   PACKER_HOME_DIR = "${env.WORKSPACE_TMP}/.packer.d"
  //   PACKER_PLUGIN_PATH = "${env.WORKSPACE_TMP}/.packer.d/plugins"
  //   TMPDIR = "${env.WORKSPACE_TMP}"
  //   DOCKER_HOST = "tcp://${DOCKER_HOST_IP}:2376"
  // }

  stages {
    // stage('Gradle Build') {
    //   agent {
    //     docker {
    //       image 'gradle:7.4.2-jdk11'
    //     }
    //   }
    //   steps {
    //     sh """
    //     #!/bin/sh
    //     cd 2-jenkins-in-docker/app
    //     gradle build -x test
    //     """
    //   }
    // }
    stage('Build Docker Image') {
      agent {
        docker {
          image 'docker:20.10.18-dind'
        }
      }
      steps {
        script {
          def dockerfile = 'Dockerfile'
          def customImage = docker.build("my-image:${env.BUILD_ID}", "-f ${dockerfile} ./2-jenkins-in-docker/app")
        }
      }
    }
  }
}